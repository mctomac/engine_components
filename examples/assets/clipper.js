var ke=Object.defineProperty;var je=(r,i,t)=>i in r?ke(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var l=(r,i,t)=>(je(r,typeof i!="symbol"?i+"":i,t),t);import{z as Le,V as c,O as re,Q as I,E as Re,a as me,d as le,L as qe,ai as g,B as u,c as ge,Y as ye,M as o,aw as ie,g as X,ax as Oe,ay as O,m as Ee,Z as Ie,P as Fe,_ as We,I as Ge,b as Ne}from"./web-ifc-api-BC8YMRiS.js";import{S as Ue}from"./stats.min-GTpOrGrX.js";import{p as $e,a as Ve,m as Je}from"./index-DyM33b1I.js";import{E as _,C as Ke,W as Ae,a as et,S as tt,b as it,c as nt}from"./index-B99Vyz6D.js";import{R as pe}from"./index-Cv1osOVr.js";import"./_commonjsHelpers-Cpj98o6Y.js";const T=new Le,f=new c,z=new c,d=new I,be={X:new c(1,0,0),Y:new c(0,1,0),Z:new c(0,0,1)},he={type:"change"},_e={type:"mouseDown"},Pe={type:"mouseUp",mode:null},Me={type:"objectChange"};class st extends re{constructor(i,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new ct;this._gizmo=n,this.add(n);const s=new pt;this._plane=s,this.add(s);const a=this;function e(w,M){let k=M;Object.defineProperty(a,w,{get:function(){return k!==void 0?k:M},set:function(C){k!==C&&(k=C,s[w]=C,n[w]=C,a.dispatchEvent({type:w+"-changed",value:C}),a.dispatchEvent(he))}}),a[w]=M,s[w]=M,n[w]=M}e("camera",i),e("object",void 0),e("enabled",!0),e("axis",null),e("mode","translate"),e("translationSnap",null),e("rotationSnap",null),e("scaleSnap",null),e("space","world"),e("size",1),e("dragging",!1),e("showX",!0),e("showY",!0),e("showZ",!0);const h=new c,m=new c,v=new I,B=new I,R=new c,q=new I,fe=new c,V=new c,A=new c,D=0,S=new c;e("worldPosition",h),e("worldPositionStart",m),e("worldQuaternion",v),e("worldQuaternionStart",B),e("cameraPosition",R),e("cameraQuaternion",q),e("pointStart",fe),e("pointEnd",V),e("rotationAxis",A),e("rotationAngle",D),e("eye",S),this._offset=new c,this._startNorm=new c,this._endNorm=new c,this._cameraScale=new c,this._parentPosition=new c,this._parentQuaternion=new I,this._parentQuaternionInv=new I,this._parentScale=new c,this._worldScaleStart=new c,this._worldQuaternionInv=new I,this._worldScale=new c,this._positionStart=new c,this._quaternionStart=new I,this._scaleStart=new c,this._getPointer=ot.bind(this),this._onPointerDown=rt.bind(this),this._onPointerHover=at.bind(this),this._onPointerMove=lt.bind(this),this._onPointerUp=ht.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(i){if(this.object===void 0||this.dragging===!0)return;T.setFromCamera(i,this.camera);const t=ce(this._gizmo.picker[this.mode],T);t?this.axis=t.object.name:this.axis=null}pointerDown(i){if(!(this.object===void 0||this.dragging===!0||i.button!==0)&&this.axis!==null){T.setFromCamera(i,this.camera);const t=ce(this._plane,T,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,_e.mode=this.mode,this.dispatchEvent(_e)}}pointerMove(i){const t=this.axis,n=this.mode,s=this.object;let a=this.space;if(n==="scale"?a="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(a="world"),s===void 0||t===null||this.dragging===!1||i.button!==-1)return;T.setFromCamera(i,this.camera);const e=ce(this._plane,T,!0);if(e){if(this.pointEnd.copy(e.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(s.position.applyQuaternion(d.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),a==="world"&&(s.parent&&s.position.add(f.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(f.setFromMatrixPosition(s.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let h=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(h*=-1),z.set(h,h,h)}else f.copy(this.pointStart),z.copy(this.pointEnd),f.applyQuaternion(this._worldQuaternionInv),z.applyQuaternion(this._worldQuaternionInv),z.divide(f),t.search("X")===-1&&(z.x=1),t.search("Y")===-1&&(z.y=1),t.search("Z")===-1&&(z.z=1);s.scale.copy(this._scaleStart).multiply(z),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const h=20/this.worldPosition.distanceTo(f.setFromMatrixPosition(this.camera.matrixWorld));let m=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(f.copy(this.rotationAxis).cross(this.eye))*h):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(be[t]),f.copy(be[t]),a==="local"&&f.applyQuaternion(this.worldQuaternion),f.cross(this.eye),f.length()===0?m=!0:this.rotationAngle=this._offset.dot(f.normalize())*h),(t==="E"||m)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(d.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(d.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(he),this.dispatchEvent(Me)}}pointerUp(i){i.button===0&&(this.dragging&&this.axis!==null&&(Pe.mode=this.mode,this.dispatchEvent(Pe)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(i){i.geometry&&i.geometry.dispose(),i.material&&i.material.dispose()})}attach(i){return this.object=i,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(he),this.dispatchEvent(Me),this.pointStart.copy(this.pointEnd))}getRaycaster(){return T}getMode(){return this.mode}setMode(i){this.mode=i}setTranslationSnap(i){this.translationSnap=i}setRotationSnap(i){this.rotationSnap=i}setScaleSnap(i){this.scaleSnap=i}setSize(i){this.size=i}setSpace(i){this.space=i}}function ot(r){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:r.button};{const i=this.domElement.getBoundingClientRect();return{x:(r.clientX-i.left)/i.width*2-1,y:-(r.clientY-i.top)/i.height*2+1,button:r.button}}}function at(r){if(this.enabled)switch(r.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(r));break}}function rt(r){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(r)),this.pointerDown(this._getPointer(r)))}function lt(r){this.enabled&&this.pointerMove(this._getPointer(r))}function ht(r){this.enabled&&(this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(r)))}function ce(r,i,t){const n=i.intersectObject(r,!0);for(let s=0;s<n.length;s++)if(n[s].object.visible||t)return n[s];return!1}const ne=new Re,p=new c(0,1,0),xe=new c(0,0,0),ve=new me,se=new I,ae=new I,E=new c,Se=new me,G=new c(1,0,0),Z=new c(0,1,0),N=new c(0,0,1),oe=new c,F=new c,W=new c;class ct extends re{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const i=new le({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new qe({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=i.clone();n.opacity=.15;const s=t.clone();s.opacity=.5;const a=i.clone();a.color.setHex(16711680);const e=i.clone();e.color.setHex(65280);const h=i.clone();h.color.setHex(255);const m=i.clone();m.color.setHex(16711680),m.opacity=.5;const v=i.clone();v.color.setHex(65280),v.opacity=.5;const B=i.clone();B.color.setHex(255),B.opacity=.5;const R=i.clone();R.opacity=.25;const q=i.clone();q.color.setHex(16776960),q.opacity=.25,i.clone().color.setHex(16776960);const V=i.clone();V.color.setHex(7895160);const A=new g(0,.04,.1,12);A.translate(0,.05,0);const D=new u(.08,.08,.08);D.translate(0,.04,0);const S=new ge;S.setAttribute("position",new ye([0,0,0,1,0,0],3));const w=new g(.0075,.0075,.5,3);w.translate(0,.25,0);function M(b,J){const x=new O(b,.0075,3,64,J*Math.PI*2);return x.rotateY(Math.PI/2),x.rotateX(Math.PI/2),x}function k(){const b=new ge;return b.setAttribute("position",new ye([0,0,0,1,1,1],3)),b}const C={X:[[new o(A,a),[.5,0,0],[0,0,-Math.PI/2]],[new o(A,a),[-.5,0,0],[0,0,Math.PI/2]],[new o(w,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new o(A,e),[0,.5,0]],[new o(A,e),[0,-.5,0],[Math.PI,0,0]],[new o(w,e)]],Z:[[new o(A,h),[0,0,.5],[Math.PI/2,0,0]],[new o(A,h),[0,0,-.5],[-Math.PI/2,0,0]],[new o(w,h),null,[Math.PI/2,0,0]]],XYZ:[[new o(new ie(.1,0),R.clone()),[0,0,0]]],XY:[[new o(new u(.15,.15,.01),B.clone()),[.15,.15,0]]],YZ:[[new o(new u(.15,.15,.01),m.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new o(new u(.15,.15,.01),v.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Ye={X:[[new o(new g(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new o(new g(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new o(new g(.2,0,.6,4),n),[0,.3,0]],[new o(new g(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new o(new g(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new o(new g(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new o(new ie(.2,0),n)]],XY:[[new o(new u(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new o(new u(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new o(new u(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},Qe={START:[[new o(new ie(.01,2),s),null,null,null,"helper"]],END:[[new o(new ie(.01,2),s),null,null,null,"helper"]],DELTA:[[new X(k(),s),null,null,null,"helper"]],X:[[new X(S,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new X(S,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new X(S,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Xe={XYZE:[[new o(M(.5,1),V),null,[0,Math.PI/2,0]]],X:[[new o(M(.5,.5),a)]],Y:[[new o(M(.5,.5),e),null,[0,0,-Math.PI/2]]],Z:[[new o(M(.5,.5),h),null,[0,Math.PI/2,0]]],E:[[new o(M(.75,1),q),null,[0,Math.PI/2,0]]]},ze={AXIS:[[new X(S,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Ce={XYZE:[[new o(new Oe(.25,10,8),n)]],X:[[new o(new O(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new o(new O(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new o(new O(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new o(new O(.75,.1,2,24),n)]]},Te={X:[[new o(D,a),[.5,0,0],[0,0,-Math.PI/2]],[new o(w,a),[0,0,0],[0,0,-Math.PI/2]],[new o(D,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new o(D,e),[0,.5,0]],[new o(w,e)],[new o(D,e),[0,-.5,0],[0,0,Math.PI]]],Z:[[new o(D,h),[0,0,.5],[Math.PI/2,0,0]],[new o(w,h),[0,0,0],[Math.PI/2,0,0]],[new o(D,h),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new o(new u(.15,.15,.01),B),[.15,.15,0]]],YZ:[[new o(new u(.15,.15,.01),m),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new o(new u(.15,.15,.01),v),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new o(new u(.1,.1,.1),R.clone())]]},Ze={X:[[new o(new g(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new o(new g(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new o(new g(.2,0,.6,4),n),[0,.3,0]],[new o(new g(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new o(new g(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new o(new g(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new o(new u(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new o(new u(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new o(new u(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new o(new u(.2,.2,.2),n),[0,0,0]]]},He={X:[[new X(S,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new X(S,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new X(S,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Y(b){const J=new re;for(const x in b)for(let j=b[x].length;j--;){const y=b[x][j][0].clone(),K=b[x][j][1],ee=b[x][j][2],te=b[x][j][3],Be=b[x][j][4];y.name=x,y.tag=Be,K&&y.position.set(K[0],K[1],K[2]),ee&&y.rotation.set(ee[0],ee[1],ee[2]),te&&y.scale.set(te[0],te[1],te[2]),y.updateMatrix();const we=y.geometry.clone();we.applyMatrix4(y.matrix),y.geometry=we,y.renderOrder=1/0,y.position.set(0,0,0),y.rotation.set(0,0,0),y.scale.set(1,1,1),J.add(y)}return J}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Y(C)),this.add(this.gizmo.rotate=Y(Xe)),this.add(this.gizmo.scale=Y(Te)),this.add(this.picker.translate=Y(Ye)),this.add(this.picker.rotate=Y(Ce)),this.add(this.picker.scale=Y(Ze)),this.add(this.helper.translate=Y(Qe)),this.add(this.helper.rotate=Y(ze)),this.add(this.helper.scale=Y(He)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(i){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ae;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let a=0;a<s.length;a++){const e=s[a];e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition);let h;if(this.camera.isOrthographicCamera?h=(this.camera.top-this.camera.bottom)/this.camera.zoom:h=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(h*this.size/4),e.tag==="helper"){e.visible=!1,e.name==="AXIS"?(e.visible=!!this.axis,this.axis==="X"&&(d.setFromEuler(ne.set(0,0,0)),e.quaternion.copy(n).multiply(d),Math.abs(p.copy(G).applyQuaternion(n).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Y"&&(d.setFromEuler(ne.set(0,0,Math.PI/2)),e.quaternion.copy(n).multiply(d),Math.abs(p.copy(Z).applyQuaternion(n).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Z"&&(d.setFromEuler(ne.set(0,Math.PI/2,0)),e.quaternion.copy(n).multiply(d),Math.abs(p.copy(N).applyQuaternion(n).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="XYZE"&&(d.setFromEuler(ne.set(0,Math.PI/2,0)),p.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(ve.lookAt(xe,p,Z)),e.quaternion.multiply(d),e.visible=this.dragging),this.axis==="E"&&(e.visible=!1)):e.name==="START"?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):e.name==="END"?(e.position.copy(this.worldPosition),e.visible=this.dragging):e.name==="DELTA"?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),f.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),f.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(f),e.visible=this.dragging):(e.quaternion.copy(n),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=this.axis.search(e.name)!==-1));continue}e.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(e.name==="X"&&Math.abs(p.copy(G).applyQuaternion(n).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="Y"&&Math.abs(p.copy(Z).applyQuaternion(n).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="Z"&&Math.abs(p.copy(N).applyQuaternion(n).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="XY"&&Math.abs(p.copy(N).applyQuaternion(n).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="YZ"&&Math.abs(p.copy(G).applyQuaternion(n).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="XZ"&&Math.abs(p.copy(Z).applyQuaternion(n).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)):this.mode==="rotate"&&(se.copy(n),p.copy(this.eye).applyQuaternion(d.copy(n).invert()),e.name.search("E")!==-1&&e.quaternion.setFromRotationMatrix(ve.lookAt(this.eye,xe,Z)),e.name==="X"&&(d.setFromAxisAngle(G,Math.atan2(-p.y,p.z)),d.multiplyQuaternions(se,d),e.quaternion.copy(d)),e.name==="Y"&&(d.setFromAxisAngle(Z,Math.atan2(p.x,p.z)),d.multiplyQuaternions(se,d),e.quaternion.copy(d)),e.name==="Z"&&(d.setFromAxisAngle(N,Math.atan2(p.y,p.x)),d.multiplyQuaternions(se,d),e.quaternion.copy(d))),e.visible=e.visible&&(e.name.indexOf("X")===-1||this.showX),e.visible=e.visible&&(e.name.indexOf("Y")===-1||this.showY),e.visible=e.visible&&(e.name.indexOf("Z")===-1||this.showZ),e.visible=e.visible&&(e.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),e.material._color=e.material._color||e.material.color.clone(),e.material._opacity=e.material._opacity||e.material.opacity,e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled&&this.axis&&(e.name===this.axis||this.axis.split("").some(function(m){return e.name===m}))&&(e.material.color.setHex(16776960),e.material.opacity=1)}super.updateMatrixWorld(i)}}class pt extends o{constructor(){super(new Ee(1e5,1e5,2,2),new le({visible:!1,wireframe:!0,side:Ie,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(i){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),oe.copy(G).applyQuaternion(t==="local"?this.worldQuaternion:ae),F.copy(Z).applyQuaternion(t==="local"?this.worldQuaternion:ae),W.copy(N).applyQuaternion(t==="local"?this.worldQuaternion:ae),p.copy(F),this.mode){case"translate":case"scale":switch(this.axis){case"X":p.copy(this.eye).cross(oe),E.copy(oe).cross(p);break;case"Y":p.copy(this.eye).cross(F),E.copy(F).cross(p);break;case"Z":p.copy(this.eye).cross(W),E.copy(W).cross(p);break;case"XY":E.copy(W);break;case"YZ":E.copy(oe);break;case"XZ":p.copy(W),E.copy(F);break;case"XYZ":case"E":E.set(0,0,0);break}break;case"rotate":default:E.set(0,0,0)}E.length()===0?this.quaternion.copy(this.cameraQuaternion):(Se.lookAt(f.set(0,0,0),E,p),this.quaternion.setFromRotationMatrix(Se)),super.updateMatrixWorld(i)}}class ue{constructor(i,t,n,s,a,e=5,h=!0){l(this,"onDraggingStarted",new _);l(this,"onDraggingEnded",new _);l(this,"onDisposed",new _);l(this,"normal");l(this,"origin");l(this,"three",new Fe);l(this,"_helper");l(this,"_visible",!0);l(this,"_enabled",!0);l(this,"components");l(this,"world");l(this,"_controlsActive",!1);l(this,"_arrowBoundBox",new o);l(this,"_planeMesh");l(this,"_controls");l(this,"_hiddenMaterial",new le({visible:!1}));l(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)});l(this,"changeDrag",i=>{this._visible=!i.value,this.preventCameraMovement(),this.notifyDraggingChanged(i)});if(this.components=i,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=s,this.origin=n,t.renderer.setPlane(!0,this.three),this._planeMesh=ue.newPlaneMesh(e,a),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(s,n),h&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(i){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=i,this.world.renderer.setPlane(i,this.three)}get visible(){return this._visible}set visible(i){this._visible=i,this._controls.visible=i,this._helper.visible=i,this.toggleControls(i)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(i){this._planeMesh.material=i}get size(){return this._planeMesh.scale.x}set size(i){this._planeMesh.scale.set(i,i,i)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(i,t){this.reset(),this.normal.equals(i)||(this.normal.copy(i),this._helper.lookAt(i)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const i=new c(1,0,0),t=new c;this.normal.equals(i)||(this.normal.copy(i),this._helper.lookAt(i)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(i){if(i){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=i}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const i=this.world.camera.three,t=this.world.renderer.three.domElement,n=new st(i,t);return this.initializeControls(n),this.world.scene.three.add(n),n}initializeControls(i){i.attach(this._helper),i.showX=!1,i.showY=!1,i.setSpace("local"),this.createArrowBoundingBox(),i.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new g(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(i){i.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const i=new re;return i.lookAt(this.normal),i.position.copy(this.origin),this._planeMesh.position.z+=.01,i.add(this._planeMesh),this.world.scene.three.add(i),i}static newPlaneMesh(i,t){const n=new Ee(1),s=new o(n,t);return s.scale.set(i,i,i),s}}const U=class U extends Ke{constructor(t){super(t);l(this,"onAfterCreate",new _);l(this,"onAfterDelete",new _);l(this,"onBeforeDrag",new _);l(this,"onAfterDrag",new _);l(this,"onBeforeCreate",new _);l(this,"onBeforeCancel",new _);l(this,"onAfterCancel",new _);l(this,"onBeforeDelete",new _);l(this,"onDisposed",new _);l(this,"orthogonalY",!1);l(this,"toleranceOrthogonalY",.7);l(this,"Type",ue);l(this,"list",[]);l(this,"_material",new le({color:12255487,side:Ie,transparent:!0,opacity:.2}));l(this,"_size",5);l(this,"_enabled",!1);l(this,"_visible",!0);l(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()});l(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()});this.components.add(U.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const n of this.list)n.enabled=t;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(t){this._visible=t;for(const n of this.list)n.visible=t}get material(){return this._material}set material(t){this._material=t;for(const n of this.list)n.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const n of this.list)n.size=t}dispose(){this._enabled=!1;for(const t of this.list)t.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(U.uuid),this.onDisposed.reset()}create(t){if(!this.enabled)return;const a=this.components.get(pe).get(t).castRay();a&&this.createPlaneFromIntersection(t,a)}createFromNormalAndCoplanarPoint(t,n,s){const a=this.newPlane(t,s,n);return this.updateMaterialsAndPlanes(),a}delete(t,n){this.enabled&&(n||(n=this.pickPlane(t)),n&&this.deletePlane(n))}deleteAll(){for(;this.list.length>0;){const t=this.list[0];this.delete(t.world,t)}}deletePlane(t){const n=this.list.indexOf(t);if(n!==-1){if(this.list.splice(n,1),!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(t)}}pickPlane(t){const s=this.components.get(pe).get(t),a=this.getAllPlaneMeshes(),e=s.castRay(a);if(e){const h=e.object;return this.list.find(m=>m.meshes.includes(h))}}getAllPlaneMeshes(){const t=[];for(const n of this.list)t.push(...n.meshes);return t}createPlaneFromIntersection(t,n){var m;if(!t.renderer)throw new Error("The given world must have a renderer!");const s=n.point.distanceTo(new c(0,0,0)),a=(m=n.face)==null?void 0:m.normal;if(!s||!a)return;const e=this.getWorldNormal(n,a),h=this.newPlane(t,n.point,e.negate());h.visible=this._visible,h.size=this._size,t.renderer.setPlane(!0,h.three),this.updateMaterialsAndPlanes()}getWorldNormal(t,n){const s=t.object;let a=t.object.matrixWorld.clone();if(s instanceof Ge&&t.instanceId!==void 0){const v=new me;s.getMatrixAt(t.instanceId,v),a=v.multiply(a)}const h=new We().getNormalMatrix(a),m=n.clone().applyMatrix3(h).normalize();return this.normalizePlaneDirectionY(m),m}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,n,s){const a=new this.Type(this.components,t,n,s,this._material);return a.onDraggingStarted.add(this._onStartDragging),a.onDraggingEnded.add(this._onEndDragging),this.list.push(a),this.onAfterCreate.trigger(a),a}updateMaterialsAndPlanes(){const t=this.components.get(Ae);for(const[n,s]of t.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:a}=s.renderer;for(const e of s.meshes)if(Array.isArray(e.material))for(const h of e.material)h.clippingPlanes=a;else e.material.clippingPlanes=a}}};l(U,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let de=U;const De=document.getElementById("container"),H=new et,dt=H.get(Ae),P=dt.create();P.scene=new tt(H);P.renderer=new it(H,De);P.camera=new nt(H);H.init();P.camera.controls.setLookAt(10,10,10,0,0,0);P.scene.setup();const mt=new u(3,3,3),ut=new Ne({color:"#6528D7"}),L=new o(mt,ut);L.position.set(0,1.5,0);P.scene.three.add(L);P.meshes.add(L);const ft=H.get(pe);ft.get(P);const Q=new de(H);Q.enabled=!0;De.ondblclick=()=>Q.create(P);window.onkeydown=r=>{(r.code==="Delete"||r.code==="Backspace")&&Q.delete(P)};const $=new Ue;$.showPanel(2);document.body.append($.dom);$.dom.style.left="0px";P.renderer.onBeforeUpdate.add(()=>$.begin());P.renderer.onAfterUpdate.add(()=>$.end());$e.init();const wt=Ve.create(()=>Je`
    <bim-panel label="Clipper Tutorial" style="position: fixed; top: 5px; right: 5px" active>
          <bim-panel-section fixed label="Commands">
      
        <bim-label label="Double click: Create clipping plane"></bim-label>
        <bim-label label="Delete key: Delete clipping plane"></bim-label>
       
        
      </bim-panel-section>
      <bim-panel-section fixed label="Others"">
          
        <bim-checkbox label="Clipper enabled" checked 
          @change="${({target:r})=>{Q.enabled=r.value}}">
        </bim-checkbox>
        
        <bim-checkbox label="Clipper visible" checked 
          @change="${({target:r})=>{Q.visible=r.value}}">
        </bim-checkbox>
      
        <bim-color-input 
          label="Planes Color" color="#202932" 
          @input="${({target:r})=>{Q.material.color.set(r.color)}}">
        </bim-color-input>
        
        <bim-number-input 
          slider step="0.01" label="Planes opacity" value="0.2" min="0.1" max="1"
          @change="${({target:r})=>{Q.material.opacity=r.value}}">
        </bim-number-input>
        
        <bim-number-input 
          slider step="0.1" label="Planes size" value="5" min="2" max="10"
          @change="${({target:r})=>{Q.size=r.value}}">
        </bim-number-input>
        
        <bim-button 
          label="Delete all" 
          @click="${()=>{Q.deleteAll()}}">  
        </bim-button>        
        
        <bim-button 
          label="Rotate cube" 
          @click="${()=>{L.rotation.x=2*Math.PI*Math.random(),L.rotation.y=2*Math.PI*Math.random(),L.rotation.z=2*Math.PI*Math.random()}}">  
        </bim-button>
       
        
      </bim-panel-section>
    </bim-panel>
    `);document.body.append(wt);
